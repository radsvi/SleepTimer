<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:gauge="clr-namespace:Syncfusion.Maui.Gauges;assembly=Syncfusion.Maui.Gauges"
             xmlns:converters="clr-namespace:SleepTimer.Converters"
             xmlns:enums="clr-namespace:SleepTimer.Enums"
             xmlns:models="clr-namespace:SleepTimer.Models"
             xmlns:viewModels="clr-namespace:SleepTimer.ViewModels"
             x:Class="SleepTimer.Views.MainPage"
             x:DataType="viewModels:MainVM">
    <ContentPage.Resources>
        <converters:InvertBoolConverter x:Key="InvertBoolConv"/>
    </ContentPage.Resources>

    <AbsoluteLayout
        Margin="5"
        >
        <StackLayout
            AbsoluteLayout.LayoutBounds="0,0,1,300"
            AbsoluteLayout.LayoutFlags="WidthProportional"
            >

            <StackLayout Orientation="Horizontal" HorizontalOptions="End" Margin="0,0,0,20">
                <Button Text="Config" Command="{Binding NavigateToPageCommand}" CommandParameter="{x:Static enums:Pages.ConfigurationPage}" />
                <Button Text="Extend" Command="{Binding ExtendTimerCommand}" />
                <!--<Button Text="↑" Command="{Binding IncreaseVolumeCommand}" />
                <Button Text="↓" Command="{Binding DecreseVolumeCommand}" />-->
            </StackLayout>

            <!-- // Timer is stopped // -->
            <Grid ColumnDefinitions="auto,*" IsVisible="{Binding MainTimer.IsStarted, Converter={StaticResource InvertBoolConv}}">
                <Label
                    Text="{Binding AppPreferences.DefaultDuration, StringFormat='{0} minutes'}"
                    FontAttributes="Bold"
                    HorizontalOptions="Start"
                    VerticalOptions="Center"
                    Margin="0,0,10,0"/>
                <Slider
                    Grid.Column="1"
                    Minimum="0"
                    Maximum="60"
                    Value="{Binding AppPreferences.DefaultDuration}"
                    VerticalOptions="Center"
                    />
            </Grid>
            
            <!-- // Timer is active // -->
            <StackLayout
                HorizontalOptions="Fill"
                IsVisible="{Binding MainTimer.IsStarted}">
                <Label
                    Text="{Binding MainTimer.RemainingTime, StringFormat='{0:mm\\:ss}'}"
                    FontSize="130"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Margin="0,0,10,0"/> <!--{0:mm\\:ss}-->
                <Label
                    Text="minutes remaining"
                    HorizontalOptions="Center"
                    />
                <Label
                    Text="last action"
                    HorizontalOptions="Center"
                    />
                <Label
                    Text="{Binding MainTimer.VolumeTest}"
                    HorizontalOptions="Center"
                    />
            </StackLayout>
        </StackLayout>

        <Grid
            AbsoluteLayout.LayoutBounds="0,1,1,0.1"
            AbsoluteLayout.LayoutFlags="All"
            >
            <!--<Button Text="Start timer" Command="{Binding StartTimerCommand}" IsVisible="{Binding MainTimer.TimerToken.Enabled, Converter={StaticResource InvertBoolConv}}" />-->
            <Button Text="Start timer" Command="{Binding StartTimerCommand}" IsVisible="{Binding MainTimer.IsStarted, Converter={StaticResource InvertBoolConv}}" />
            <Button Text="Stop timer" Command="{Binding StopTimerCommand}" IsVisible="{Binding MainTimer.IsStarted}" />

        </Grid>

    </AbsoluteLayout>
</ContentPage>
